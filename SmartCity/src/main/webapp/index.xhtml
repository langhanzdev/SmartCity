<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:pe="http://primefaces.org/ui/extensions">
    <h:head>
        <title>Smart City Control</title>
        
        <link src="https://openlayers.org/en/v5.2.0/css/ol.css" type="text/css"/>
        <!-- The line below is only needed for old environments like Internet Explorer and Android 4.x -->
        <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
        
        <h:outputStylesheet name="/css/default.css"/>
        <h:outputStylesheet name="/css/cssLayout.css"/>
        <h:outputStylesheet name="/css/OpenLayersStyle.css"/>
        <h:outputStylesheet name="/css/custom.css"/> 
        <h:outputStylesheet name="/css/bootstrap.css"/> 
        <style type="text/css">
      html, body, #basicMap {
          width: 100%;
          height: 100%;
          margin: 0;
      }
    </style>
    <h:outputStylesheet name="css/OpenLayersStyle.css"/>
    <script src="OpenLayers.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        
    function init() {
          
        var projection = new OpenLayers.Projection("EPSG:900913");
        var displayProjection = new OpenLayers.Projection("EPSG:4326");
        var options = {
                   // projection: projection,
//                    displayProjection: displayProjection,
                    units: "m",
                    maxResolution: 156543.0339,
                    maxExtent: new OpenLayers.Bounds(-20037508.34, -20037508.34,
                            20037508.34, 20037508.34),
                    crossOriginKeyword: null,
                    numZoomLevels: 19,
                    controls: [
                        new OpenLayers.Control.Navigation(),
                        //new OpenLayers.Control.PanZoomBar(),
                        new OpenLayers.Control.Permalink(),
                        new OpenLayers.Control.ScaleLine(),
                        //new OpenLayers.Control.SelectFeature(),
                        new OpenLayers.Control.MousePosition({}),
                        new OpenLayers.Control.KeyboardDefaults()
                    ]
                };
             
        map = new OpenLayers.Map("basicMap", options);
        var vectorLayer = new OpenLayers.Layer.Vector("Overlay");
        
        var mapnik         = new OpenLayers.Layer.OSM();
        var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
        var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
        var position       = new OpenLayers.LonLat(-51.19,-30.05).transform( fromProjection, toProjection);
        var zoom           = 15; 
        
//        var feature = new OpenLayers.Feature.Vector(
//            new OpenLayers.Geometry.Point(parseFloat(-51.19,-30.05)).transform(fromProjection, toProjection)
//            
//        );
        map.addLayer(mapnik);



        var markers = new OpenLayers.Layer.Markers( "Markers" );
        map.addLayer(markers);
            
        var lonLat = new OpenLayers.LonLat( -51.19,-30.05 ).transform(
            new OpenLayers.Projection("EPSG:4326"), // transform from WGS 1984
            map.getProjectionObject() // to Spherical Mercator Projection
          );
        var size = new OpenLayers.Size(21,25);
        var offset = new OpenLayers.Pixel(-(size.w/2), -size.h);
        var icon = new OpenLayers.Icon('javax.faces.resource/img/icon.png.xhtml', size, offset);  
            
         //   markers.addMarker(new OpenLayers.Marker(lonLat,icon));
            //markers.addMarker(new OpenLayers.Marker(lonLat,icon.clone()));
//        vectorLayer.addFeatures(feature);
//        map.addLayer(vectorLayer);
         
        
        
        markers.addMarker(new OpenLayers.Marker(lonLat));
        
        map.setCenter(position, zoom );
        map.addLayer(vectorLayer);
        var point = new OpenLayers.Geometry.Point( -51.19,-30.05);
var style =  {
    externalGraphic: 'javax.faces.resources/img/icon.png.xhtml',
    graphicWidth: 21,
    graphicHeight: 25,
    graphicYOffset: -24
};
var pointFeature = new OpenLayers.Feature.Vector(point, null, style);
        vectorLayer.addFeatures(pointFeature);
        var s = "";
                $.get('devices', {action: 0}, function (responseText) {

                    $.each(responseText, function (index, item) { // Iterate over the JSON array.
                        alert(index);
                        var feature = new OpenLayers.Feature.Vector(
                            new OpenLayers.Geometry.Point(parseFloat(item['longitude']), parseFloat(item['latitude'])).transform(fromProjection, toProjection)
                        );
                        
                        vectorLayer.addFeatures(feature);
                    });
                });
        
        
        
      }
      
      
      function openCloseToolBar(){
          
          
          
      }
    </script>
    </h:head>
    <h:body onload="init();">
        <div id="basicMap"></div>
        <h:form style="width: 100%;"   prependId="false">  
            <p:growl id="messages" showDetail="true" sticky="true" life="3000"/>  
            <p:menubar >

                <p:menuitem value="Situation Control" url="/index.xhtml" icon="ui-icon-home" />
                
                
                <f:facet name="options">
                    <h:graphicImage id="logoH" style="height: 25px;margin-bottom: 0; margin-top: 2px;margin-right: 600px;" name="/img/icon.png"/> 
                    <h:graphicImage id="loader" style="display: none;height: 19px;padding-bottom: 6px;margin-bottom: 0; margin-top: 2px;margin-right: 615px;" name="/img/HuaweiLoader.gif"/> 

                    <p:inputText style="margin-right:10px" placeholder="Search"/>
                    <p:commandButton type="button" value="Logout" icon="ui-icon-extlink" /> 

                </f:facet>

            </p:menubar>

        </h:form>
        
        <div id="infoBar"></div>
        
    
  
    </h:body>
</html>

